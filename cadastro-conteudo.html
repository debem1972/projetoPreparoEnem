<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Conte√∫do</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts (Caveat e Roboto) -->
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&family=Roboto:wght@400;700&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Caveat', cursive;
            background-color: #f8f9fa;
        }

        .container {
            max-width: 800px;
            margin-top: 50px;
        }

        h1 {
            font-family: 'Roboto', sans-serif;
            text-align: center;
            margin-bottom: 30px;
        }

        .form-label {
            font-family: 'Roboto', sans-serif;
        }

        #contentInput {
            font-family: 'Roboto', sans-serif;
            height: 300px;
            resize: vertical;
        }

        .btn-primary {
            font-family: 'Roboto', sans-serif;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Cadastro de Novo Conte√∫do</h1>
        <form id="contentForm">
            <div class="mb-3">
                <label for="materiaSelect" class="form-label">Mat√©ria</label>
                <select id="materiaSelect" class="form-select" required>
                    <option value="">Selecione a mat√©ria</option>
                    <option value="Matem√°tica">Matem√°tica</option>
                    <option value="Portugu√™s">Portugu√™s</option>
                    <option value="Literatura">Literatura</option>
                    <option value="Reda√ß√£o">Reda√ß√£o</option>
                    <option value="Hist√≥ria">Hist√≥ria</option>
                    <option value="Geografia">Geografia</option>
                    <option value="F√≠sica">F√≠sica</option>
                    <option value="Qu√≠mica">Qu√≠mica</option>
                    <option value="Biologia">Biologia</option>
                    <option value="Sociologia">Sociologia</option>
                    <option value="Filosofia">Filosofia</option>
                    <option value="Ingl√™s">Ingl√™s</option>
                    <option value="Espanhol">Espanhol</option>
                    <option value="Reda√ß√£o, Literatura e Portugu√™s">Reda√ß√£o, Literatura e Portugu√™s</option>
                    <option value="Hist√≥ria e Geografia">Hist√≥ria e Geografia</option>
                    <option value="Biologia Celular">Biologia Celular</option>
                    <option value="Sociologia + Filosofia">Sociologia + Filosofia</option>
                    <option value="Desconhecida">Outra/Desconhecida</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="monthSelect" class="form-label">M√™s</label>
                <select id="monthSelect" class="form-select" required>
                    <option value="">Selecione o m√™s</option>
                    <option value="junho">Junho</option>
                    <option value="julho">Julho</option>
                    <option value="agosto">Agosto</option>
                    <option value="setembro">Setembro</option>
                    <option value="outubro">Outubro</option>
                    <option value="novembro">Novembro</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="weekSelect" class="form-label">Semana</label>
                <select id="weekSelect" class="form-select" required>
                    <option value="">Selecione a semana</option>
                    <option value="1">1¬™ Semana</option>
                    <option value="2">2¬™ Semana</option>
                    <option value="3">3¬™ Semana</option>
                    <option value="4">4¬™ Semana</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="daySelect" class="form-label">Dia</label>
                <select id="daySelect" class="form-select" required>
                    <option value="">Selecione o dia</option>
                    <option value="segunda">Segunda</option>
                    <option value="terca">Ter√ßa</option>
                    <option value="quarta">Quarta</option>
                    <option value="quinta">Quinta</option>
                    <option value="sexta">Sexta</option>
                    <option value="sabado">S√°bado</option>
                    <option value="domingo">Domingo</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="contentInput" class="form-label">Conte√∫do (em HTML)</label>
                <textarea id="contentInput" class="form-control" required
                    placeholder="Insira o conte√∫do em HTML, come√ßando com <h2> contendo a mat√©ria..."></textarea>
            </div>
            <!--Modal-->

            <div class="modal fade" id="modeloAulaHtml" tabindex="-1" aria-labelledby="modalDeModeloAulaHtml"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="exampleModalCenteredScrollableTitle">
                                <font style="vertical-align: inherit;">
                                    <font style="vertical-align: inherit;">Modelo de aula</font>
                                </font>
                            </h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                aria-label="Fechar"></button>
                        </div>
                        <div class="modal-body" id="modeloAulaContent">
                            <h2>üìö Matem√°tica B√°sica - 02/06/2025</h2>
                            <h3>1Ô∏è‚É£ Teoria Essencial</h3>
                            <h4>üî¢ Conjuntos Num√©ricos</h4>
                            <p><a href="https://youtu.be/s5Xv1SIQnQE?si=4mEOT0Aczrf7sgL9" target="_blank">V√≠deo:
                                    Conjuntos Num√©ricos (Sandro Curi√≥)</a></p>
                            <ul>
                                <li>Naturais (‚Ñï): 0, 1, 2, 3, ...</li>
                                <li>Inteiros (‚Ñ§): ... -2, -1, 0, 1, 2, ...</li>
                                <li>Racionais (‚Ñö): fra√ß√µes (1/2), decimais exatos e peri√≥dicos (0,333...)</li>
                                <li>Irracionais (I): ra√≠zes n√£o exatas (‚àö2, œÄ)</li>
                                <li>Reais (‚Ñù): todos os anteriores</li>
                            </ul>
                            <h4>üü∞ Fra√ß√µes</h4>
                            <p><a href="https://youtu.be/dZfWflhf_IU?si=pyyOnVdIh9HbAG0K" target="_blank">V√≠deo:
                                    Opera√ß√µes com Fra√ß√µes (Sandro Curi√≥)</a></p>
                            <p>Defini√ß√£o: parte de um todo (a/b, b‚â†0)</p>
                            <p>Opera√ß√µes b√°sicas:</p>
                            <ul>
                                <li>Soma/Subtra√ß√£o: mesmo denominador ‚Üí soma direta; diferente denominador ‚Üí MMC</li>
                                <li>Multiplica√ß√£o: numerador√ónumerador / denominador√ódenominador</li>
                                <li>Divis√£o: inverte a segunda fra√ß√£o e multiplica</li>
                            </ul>
                            <h4>üíØ Porcentagem</h4>
                            <p><a href="https://youtu.be/azedx0uou64?si=tjO5wxYwBMslY43s" target="_blank">V√≠deo:
                                    Porcentagem (Sandro Curi√≥)</a></p>
                            <p>1% = 1/100 (por cento)</p>
                            <p>Para calcular:</p>
                            <p>\\[ \\text{Porcentagem} = \\frac{\\text{parte}}{\\text{total}} \\times 100 \\]</p>
                            <h3>2Ô∏è‚É£ Exerc√≠cios de Fixa√ß√£o (10 quest√µes)</h3>
                            <ol>
                                <li>Escreva o conjunto dos n√∫meros inteiros entre -3 e 3.</li>
                                <li>D√™ um exemplo de n√∫mero irracional.</li>
                                <li>Some as fra√ß√µes 1/4 + 2/3.</li>
                                <li>Subtraia: 3/5 - 1/2.</li>
                                <li>Multiplique: 2/3 √ó 3/4.</li>
                                <li>Divida: 5/6 √∑ 2/3.</li>
                                <li>Calcule 25% de 200.</li>
                                <li>Se 30 √© 15% de um n√∫mero, qual √© o n√∫mero?</li>
                                <li>Um produto custa R$ 80,00 e teve aumento de 20%. Qual o novo pre√ßo?</li>
                                <li>Um desconto de 10% em R$ 150,00. Quanto √© o desconto?</li>
                            </ol>
                            <h3>3Ô∏è‚É£ Resolu√ß√£o Comentada</h3>
                            <p><strong>‚úÖ Quest√£o 1:</strong> Inteiros entre -3 e 3: {-2, -1, 0, 1, 2}<br>üëâ Dica:
                                incluir todos sem extremos!</p>
                            <p><strong>‚úÖ Quest√£o 2:</strong> Ex.: ‚àö2 (n√£o tem d√≠zima peri√≥dica)<br>üëü Dica: decore
                                exemplos cl√°ssicos: ‚àö2, ‚àö3, œÄ</p>
                            <p><strong>‚úÖ Quest√£o 3:</strong> 1/4 + 2/3<br>MMC(4,3)=12 ‚Üí 1/4=3/12 e
                                2/3=8/12<br>3/12+8/12=11/12</p>
                            <p><strong>‚úÖ Quest√£o 4:</strong> 3/5 - 1/2<br>MMC(5,2)=10 ‚Üí 3/5=6/10 e
                                1/2=5/10<br>6/10-5/10=1/10</p>
                            <p><strong>‚úÖ Quest√£o 5:</strong> 2/3√ó3/4=6/12=1/2</p>
                            <p><strong>‚úÖ Quest√£o 6:</strong> 5/6 √∑ 2/3=5/6√ó3/2=15/12=5/4=1,25</p>
                            <p><strong>‚úÖ Quest√£o 7:</strong> 25% de 200 = (25/100)√ó200=50</p>
                            <p><strong>‚úÖ Quest√£o 8:</strong> 30=15% de X ‚Üí 30=0,15√óX ‚Üí X=200</p>
                            <p><strong>‚úÖ Quest√£o 9:</strong> Aumento: 20% de 80 = 0,20√ó80=16 ‚Üí 80+16=96</p>
                            <p><strong>‚úÖ Quest√£o 10:</strong> Desconto: 10% de 150 = 0,10√ó150=15</p>

                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-success" id="copiarModeloBtn">Copiar modelo</button>
                            <button type="button" class="btn btn-danger" data-bs-dismiss="modal">
                                Fechar
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <button type="button" class="btn btn-secondary" title="Clique aqui para o modelo de aula em html"
                data-bs-toggle="modal" data-bs-target="#modeloAulaHtml">Modelo aula</button>
            <button type="submit" class="btn btn-primary">Lan√ßar Conte√∫do</button>
        </form>
    </div>

    <!-- Bootstrap 5 JS e Popper -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>
    <script>
        let dbInstance = null;

        // Fun√ß√£o para inicializar o IndexedDB
        // Fun√ß√£o para inicializar o IndexedDB
        function initDB() {
            return new Promise((resolve, reject) => {
                if (dbInstance) {
                    resolve(dbInstance);
                    return;
                }
                const request = indexedDB.open('PlanoDeEstudosDB', 2);
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains('planos')) {
                        db.createObjectStore('planos', { keyPath: 'id', autoIncrement: true });
                    }
                    if (!db.objectStoreNames.contains('desempenho')) {
                        db.createObjectStore('desempenho', { keyPath: 'id', autoIncrement: true });
                    }
                    if (!db.objectStoreNames.contains('postits')) {
                        db.createObjectStore('postits', { keyPath: 'id', autoIncrement: true });
                    }
                    if (!db.objectStoreNames.contains('conteudos')) {
                        db.createObjectStore('conteudos', { keyPath: 'key' });
                    }
                };
                request.onsuccess = (event) => {
                    dbInstance = event.target.result;
                    resolve(dbInstance);
                };
                request.onerror = (event) => {
                    reject(new Error('Erro ao abrir o IndexedDB'));
                };
                request.onblocked = () => {
                    reject(new Error('Abertura do IndexedDB bloqueada. Feche outras inst√¢ncias do aplicativo.'));
                };
            });
        }

        // Fun√ß√£o para salvar conte√∫do
        async function saveContent(key, content, materia) {
            try {
                const db = await initDB();
                const transaction = db.transaction(['conteudos'], 'readwrite');
                const store = transaction.objectStore('conteudos');
                await store.put({ key, content, materia });
                console.log('Conte√∫do salvo com sucesso!');
            } catch (error) {
                console.error('Erro ao salvar conte√∫do:', error);
                throw error;
            }
        }

        // Fun√ß√£o para extrair mat√©ria do h2
        function extractMateria(content) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(content, 'text/html');
            const h2 = doc.querySelector('h2');
            if (h2) {
                const text = h2.textContent.trim();
                const match = text.match(/üìö\s*([^‚Äì-]+)(?:\s*‚Äì.*)?/); // Extrai at√© o tra√ßo ou fim
                return match ? match[1].trim() : 'Desconhecida';
            }
            return 'Desconhecida';
        }

        // Fun√ß√£o para atualizar mat√©rias
        async function updateMaterias(materia) {
            try {
                const materias = JSON.parse(localStorage.getItem('materias') || '[]');
                if (!materias.includes(materia)) {
                    materias.push(materia);
                    localStorage.setItem('materias', JSON.stringify(materias));
                }
            } catch (error) {
                console.error('Erro ao atualizar mat√©rias:', error);
            }
        }

        // Manipula√ß√£o do formul√°rio
        document.getElementById('contentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const materiaSelected = document.getElementById('materiaSelect').value;
            const month = document.getElementById('monthSelect').value;
            const week = document.getElementById('weekSelect').value;
            const day = document.getElementById('daySelect').value;
            const content = document.getElementById('contentInput').value;

            if (!materiaSelected || !month || !week || !day || !content) {
                alert('Por favor, preencha todos os campos!');
                return;
            }

            const key = `${month}-${week}-${day}`;
            // Usar mat√©ria selecionada no campo, com fallback para extra√ß√£o autom√°tica
            const materia = materiaSelected !== 'Desconhecida' ? materiaSelected : extractMateria(content);

            try {
                await saveContent(key, content, materia);
                await updateMaterias(materia);
                alert('Conte√∫do lan√ßado com sucesso!');
                document.getElementById('contentForm').reset();
            } catch (error) {
                alert('Erro ao lan√ßar conte√∫do. Verifique o console.');
            }
        });

        //---------------------------------------------------------------
        // Fun√ß√£o para copiar o HTML do modelo para a √°rea de transfer√™ncia
        document.getElementById('copiarModeloBtn').addEventListener('click', function () {
            //Obter o valor do conte√∫do do modelo de aula
            const modeloAulaContent = document.getElementById('modeloAulaContent');
            const textoHtml = modeloAulaContent.innerHTML;
            // Copiar o conte√∫do para a √°rea de transfer√™ncia
            navigator.clipboard.writeText(textoHtml).then(function () {
                alert('Conte√∫do copiado para a √°rea de transfer√™ncia!');
            }).catch(function (err) {
                console.error('Erro ao copiar: ', err);
            });
        });


    </script>
</body>

</html>